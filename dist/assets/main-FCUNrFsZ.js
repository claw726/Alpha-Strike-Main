import{c as s,i as c,f as a,d as i}from"./common-IQxCJoLi.js";if("loading"in HTMLImageElement.prototype)document.querySelectorAll('img[loading="lazy"]').forEach(e=>{e.src=e.dataset.src});else{const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js",document.body.appendChild(n)}class r{constructor(e,t){this.url=e,this.containerId=t,this.ws=null,this.reconnectDelay=5e3}connect(){try{this.ws=new WebSocket(this.url),this.setupEventHandlers()}catch(e){console.error("WebSocket connection error:",e),this.scheduleReconnect()}}setupEventHandlers(){this.ws.onopen=()=>{console.log("WebSocket connection established.")},this.ws.onmessage=e=>{this.handleMessage(e)},this.ws.onerror=e=>{console.error("WebSocket error:",e)},this.ws.onclose=()=>{console.log(`WebSocket connection closed. Code: ${event.code}, Reason: ${event.reason}`),this.scheduleReconnect()}}handleMessage(e){let t;try{t=JSON.parse(e.data)}catch{console.log("WebSocket received non-JSON message or malformed JSON:",e.data);return}typeof t=="object"&&t!==null&&(Object.prototype.hasOwnProperty.call(t,"killer_name")||Object.prototype.hasOwnProperty.call(t,"victim_name")||Object.prototype.hasOwnProperty.call(t,"time_stamp"))?this.addNewIncident(t):console.log("WebSocket received valid JSON, but not recognized as an incident:",t)}addNewIncident(e){const t=document.getElementById(this.containerId);if(t){const o=s(e);o?t.insertBefore(o,t.firstChild):console.warn("Websocket: Incident item did not result in a displayable card:",e)}else console.error(`WebSocket: Container with ID ${this.containerId} not found for new incident.`)}scheduleReconnect(){setTimeout(()=>{this.connect()},this.reconnectDelay)}disconnect(){this.ws&&(this.ws.onclose=null,this.ws.close(1e3,"Client initiated disconnect"),this.ws=null,console.log("WebSocket connection intentionally closed."))}}document.addEventListener("DOMContentLoaded",async()=>{c("home");try{const e=await a();i(e,"data-container",s,{sortBy:"time_stamp",sortDirection:"desc",limit:100,noDataMessage:"No recent incidents found."})}catch{document.getElementById("data-container").textContent="Failed to load data."}new r("wss://api.alpha-strike.space/ws/mails","data-container").connect()});
